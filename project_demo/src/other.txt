#include <SDL2/SDL.h>

// Hàm xử lý di chuyển khi nhấn hoặc giữ phím
void handleMovement(SDL_Event &e, int &x, int &y, int speed, int initialMoveSpeed,
                    bool &moveUp, bool &moveDown, bool &moveLeft, bool &moveRight,
                    bool &movedUp, bool &movedDown, bool &movedLeft, bool &movedRight) {
    // Xử lý sự kiện phím nhấn và thả
    if (e.type == SDL_KEYDOWN) {
        if (e.key.keysym.sym == SDLK_UP) {
            if (!movedUp) {
                y -= initialMoveSpeed;  // Di chuyển ít khi nhấn
                movedUp = true;
            }
            moveUp = true;
        } else if (e.key.keysym.sym == SDLK_DOWN) {
            if (!movedDown) {
                y += initialMoveSpeed;  // Di chuyển ít khi nhấn
                movedDown = true;
            }
            moveDown = true;
        } else if (e.key.keysym.sym == SDLK_LEFT) {
            if (!movedLeft) {
                x -= initialMoveSpeed;  // Di chuyển ít khi nhấn
                movedLeft = true;
            }
            moveLeft = true;
        } else if (e.key.keysym.sym == SDLK_RIGHT) {
            if (!movedRight) {
                x += initialMoveSpeed;  // Di chuyển ít khi nhấn
                movedRight = true;
            }
            moveRight = true;
        }
    } else if (e.type == SDL_KEYUP) {
        if (e.key.keysym.sym == SDLK_UP) {
            moveUp = false;
            movedUp = false;  // Đặt lại trạng thái khi thả phím
        } else if (e.key.keysym.sym == SDLK_DOWN) {
            moveDown = false;
            movedDown = false;  // Đặt lại trạng thái khi thả phím
        } else if (e.key.keysym.sym == SDLK_LEFT) {
            moveLeft = false;
            movedLeft = false;  // Đặt lại trạng thái khi thả phím
        } else if (e.key.keysym.sym == SDLK_RIGHT) {
            moveRight = false;
            movedRight = false;  // Đặt lại trạng thái khi thả phím
        }
    }

    // Di chuyển liên tục nếu giữ phím
    if (moveUp) {
        y -= speed;
    }
    if (moveDown) {
        y += speed;
    }
    if (moveLeft) {
        x -= speed;
    }
    if (moveRight) {
        x += speed;
    }
}

int main() {
    // Khởi tạo SDL
    SDL_Init(SDL_INIT_VIDEO);

    // Tạo cửa sổ và renderer
    SDL_Window* window = SDL_CreateWindow("SDL Move Example", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, 800, 600, SDL_WINDOW_SHOWN);
    SDL_Renderer* renderer = SDL_CreateRenderer(window, -1, SDL_RENDERER_ACCELERATED);

    // Tọa độ ban đầu của hình chữ nhật
    int x = 400, y = 300;
    const int speed = 5;  // Tốc độ di chuyển liên tục
    const int initialMoveSpeed = 10;  // Tốc độ di chuyển khi nhấn (di chuyển ít)

    // Biến lưu trạng thái các phím
    bool moveUp = false, moveDown = false, moveLeft = false, moveRight = false;
    bool movedUp = false, movedDown = false, movedLeft = false, movedRight = false;

    bool running = true;
    SDL_Event e;

    while (running) {
        // Xử lý các sự kiện
        while (SDL_PollEvent(&e) != 0) {
            if (e.type == SDL_QUIT) {
                running = false;
            }
            // Gọi hàm xử lý di chuyển
            handleMovement(e, x, y, speed, initialMoveSpeed, moveUp, moveDown, moveLeft, moveRight, movedUp, movedDown, movedLeft, movedRight);
        }

        // Xóa màn hình
        SDL_RenderClear(renderer);

        // Vẽ hình chữ nhật vào màn hình
        SDL_Rect rect = { x, y, 50, 50 };  // Hình chữ nhật có kích thước 50x50
        SDL_SetRenderDrawColor(renderer, 255, 0, 0, 255);  // Màu đỏ
        SDL_RenderFillRect(renderer, &rect);

        // Cập nhật màn hình
        SDL_RenderPresent(renderer);

        // Giới hạn tốc độ khung hình (FPS)
        SDL_Delay(16);  // Khoảng 60 FPS
    }

    // Hủy các đối tượng SDL
    SDL_DestroyRenderer(renderer);
    SDL_DestroyWindow(window);
    SDL_Quit();

    return 0;
}
